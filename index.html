<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cliente</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* RESET & BASE */
        :root { --primary: #000000; --bg: #ffffff; --gray: #f3f4f6; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; margin: 0; height: 100vh; width: 100vw; overflow: hidden; display: flex; flex-direction: column; background: #222; }
        
        /* MAPA OSCURO */
        #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }

        /* MENU HAMBURGUESA */
        .menu-btn { 
            position: absolute; top: 15px; left: 15px; z-index: 10; 
            background: white; width: 45px; height: 45px; border-radius: 50%; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); border: none; 
            display: flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer;
        }

        /* PANEL INFERIOR (BOTTOM SHEET) */
        .sheet {
            position: absolute; bottom: 0; left: 0; width: 100%; 
            background: white; border-radius: 20px 20px 0 0;
            box-shadow: 0 -5px 30px rgba(0,0,0,0.3); z-index: 20;
            padding: 20px; padding-bottom: 30px;
            max-height: 85vh; overflow-y: auto;
            transform: translateY(0); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        
        /* FORMULARIO DIRECCIONES (Estilo Uber) */
        .input-container {
            background: #f1f1f1; border-radius: 12px; padding: 15px; margin-bottom: 15px;
            position: relative;
        }
        .input-row { display: flex; align-items: center; margin-bottom: 12px; }
        .input-row:last-child { margin-bottom: 0; }
        .dot { width: 8px; height: 8px; border-radius: 50%; margin-right: 12px; flex-shrink: 0; }
        .square { width: 8px; height: 8px; background: black; margin-right: 12px; flex-shrink: 0; }
        .addr-input { 
            background: transparent; border: none; width: 100%; font-size: 15px; 
            font-weight: 500; outline: none; color: #333; text-overflow: ellipsis; white-space: nowrap; overflow: hidden;
        }
        .line-connector {
            position: absolute; left: 18px; top: 32px; bottom: 32px; width: 2px; background: #ddd;
        }

        /* TIPOS DE VIAJE */
        .ride-selector { margin-top: 10px; display: none; } /* Oculto hasta calcular */
        .ride-selector.show { display: block; }
        
        .ride-option {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px; border: 2px solid transparent; border-radius: 12px;
            margin-bottom: 8px; cursor: pointer; transition: 0.2s;
        }
        .ride-option.selected { background: #f9f9f9; border-color: black; }
        .ride-icon { font-size: 24px; margin-right: 10px; }
        .ride-details { flex: 1; }
        .ride-price { font-weight: 700; font-size: 16px; }

        /* BOTON NEGRO GRANDE */
        .btn-black {
            width: 100%; background: black; color: white; padding: 16px; 
            border-radius: 12px; font-weight: 700; font-size: 16px; border: none;
            margin-top: 10px; cursor: pointer;
        }
        .btn-black:disabled { background: #ccc; cursor: not-allowed; }

        /* ESTADO VIAJE (Panel Activo) */
        #tripStatus { display: none; }
        .driver-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .driver-pic { width: 60px; height: 60px; background: #eee; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .actions-row { display: flex; gap: 10px; }
        .btn-round { width: 50px; height: 50px; border-radius: 50%; border: 1px solid #eee; background: white; display: flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; }

        /* UTILIDADES */
        .hidden { display: none !important; }
        .loader { position: fixed; inset: 0; background: white; z-index: 100; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>
    <div id="loader" class="loader">Cargando...</div>

    <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
    <div id="map"></div>

    <div class="sheet" id="mainSheet">
        
        <div id="bookingForm">
            <h2 style="margin:0 0 15px 0; font-size: 20px;">¬øA d√≥nde vas?</h2>
            
            <div class="input-container">
                <div class="line-connector"></div>
                <div class="input-row" onclick="setPunto('origen')">
                    <div class="dot" style="background:#000"></div>
                    <input id="orgInput" class="addr-input" readonly placeholder="Ubicaci√≥n actual" value="Tu ubicaci√≥n">
                </div>
                <div style="height:1px; background:#e5e5e5; margin: 10px 0 10px 20px;"></div>
                <div class="input-row" onclick="setPunto('destino')">
                    <div class="square"></div>
                    <input id="dstInput" class="addr-input" readonly placeholder="¬øA d√≥nde quieres ir?">
                </div>
            </div>

            <div id="rideList" class="ride-selector">
                <div class="ride-option selected" onclick="selectRide('directo', this)">
                    <div style="display:flex; align-items:center">
                        <span class="ride-icon">üèçÔ∏è</span>
                        <div class="ride-details">
                            <div style="font-weight:600">Moto Directa</div>
                            <div style="font-size:12px; color:#666">M√°s r√°pida</div>
                        </div>
                    </div>
                    <div class="ride-price" id="priceDirect">L --</div>
                </div>

                <div class="ride-option" onclick="selectRide('colectivo', this)">
                    <div style="display:flex; align-items:center">
                        <span class="ride-icon">üöê</span>
                        <div class="ride-details">
                            <div style="font-weight:600">Colectivo</div>
                            <div style="font-size:12px; color:green">Econ√≥mico</div>
                        </div>
                    </div>
                    <div class="ride-price" id="pricePool">L --</div>
                </div>
                
                <input type="hidden" id="selectedType" value="directo">
                <button id="btnConfirm" class="btn-black" onclick="pedir()">Confirmar Moto</button>
            </div>
        </div>

        <div id="tripStatus">
            <h2 id="statusTitle" style="margin:0; color:#2563eb">Buscando conductor...</h2>
            <p id="statusMsg" style="color:#666; margin: 5px 0 20px 0; font-size:14px">Conectando con mototaxis cercanas</p>
            
            <div id="driverCard" class="hidden">
                <div class="driver-info">
                    <div style="flex:1">
                        <div style="font-size:18px; font-weight:700" id="drvName">Nombre</div>
                        <div style="color:#666; font-size:14px" id="drvMoto">Moto ‚Ä¢ Placa</div>
                        <div style="background:#eee; display:inline-block; padding:2px 8px; border-radius:4px; font-size:12px; margin-top:5px">‚≠ê 5.0</div>
                    </div>
                    <div class="driver-pic">üë§</div>
                </div>
                <div class="actions-row">
                    <button class="btn-round" onclick="llamar()">üìû</button>
                    <div style="flex:1; background:#f3f3f3; border-radius:25px; display:flex; align-items:center; padding:0 20px; font-weight:bold; color:#333">
                        Enviar mensaje...
                    </div>
                </div>
            </div>

            <button onclick="cancelar()" style="width:100%; margin-top:20px; padding:15px; border:none; background:white; color:#ef4444; font-weight:bold; cursor:pointer">Cancelar Viaje</button>
        </div>

    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.js"></script>
    <script src="../shared/config.js"></script>
    <script src="app.js"></script>
</body>
</html>
